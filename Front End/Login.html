<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login Form</title>
<link rel="stylesheet" href="Styles/loginStyle.css"> <!-- Updated stylesheet path -->
</head>
<body>
    
<div class="login-container">
  <h2>Login</h2>
  <form id="loginForm">
    <label for="uname">Username</label>
    <input type="text" placeholder="Enter Username" name="uname" required>
    <label for="psw">Password</label>
    <input type="password" placeholder="Enter Password" name="psw" required>
    <button type="submit" id="loginButton">Login</button>
  </form>
  <div class="link-container">
    <div class="register-link">
      <a href="#">Register</a>
    </div>
    <div class="password-reset-link">
      <a href="#">Forgot password?</a>
    </div>
  </div>
</div>

<!-- Import userLoginData.js -->
<script src="../Back%20End/userLoginData.js"></script>
<script src="scripts/JSONtest.js"></script> <!-- Updated script path -->
<!-- Main script -->
<script>
window.onload = function() {
  // Autofocus on the username input field
  document.querySelector('input[name="uname"]').focus();
};

// Function to handle form submission
async function handleSubmit(event) {
    event.preventDefault(); // Prevent default form submission

    // Get form data
    const formData = new FormData(event.target);
    const username = formData.get('uname');
    const password = formData.get('psw');

    try {
        // Check if username and password are correct
        const result = await searchUser(username, password);
        if (result.found) {
            const { uid } = result;
            // If correct, redirect to mainPage.html with UID as a query parameter
            window.location.href = `tempMainPage.html?uid=${uid}`;
        } else {
            // If incorrect, show error message
            alert('Invalid username or password. Please try again.');
        }
    } catch (error) {
        console.error('Error searching for user:', error);
        // Handle error, such as displaying an error message
    }
}

// Add event listener to the form for submit event
const loginForm = document.getElementById('loginForm');
loginForm.addEventListener('submit', handleSubmit);

// Prevent double submission
let formSubmitted = false;
loginForm.addEventListener('submit', function() {
    if (formSubmitted) {
        // If form has already been submitted, disable the submit button
        document.getElementById('loginButton').setAttribute('disabled', 'disabled');
    } else {
        formSubmitted = true;
    }
});
</script>

</body>
</html>
